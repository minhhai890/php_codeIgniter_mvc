$( document ).ready(function() {// FUNCTION DEFAULT=======================
$('#main .menu-right .content ul li a.space').closest('li').css({ 'margin-top': '15px', 'border-top': '1px solid #E8E8E8' });
// Hàm kiểm tra input hợp lệ
$.fn.inputCheck = function (check) {
	var eltParent = $(this).closest('div');
	$(eltParent).find('i').remove();
	$(this).attr('data-check', check);
	if (check == true) {
		$(eltParent).append('<i class="fa fa-check" aria-hidden="true"></i>');
	} else {
		if (!$(this).val()) {
			if ($(this).attr('data-require') == 'true') {
				$(eltParent).append('<i class="fa fa-times" aria-hidden="true"></i>');
			}
		} else {
			$(eltParent).append('<i class="fa fa-times" aria-hidden="true"></i>');
		}
	}
}

// input requirer
function inputRequire() {
	$('.checkinput [data-require="true"]').each(function () {
		if ($(this).val()) {
			$(this).inputCheck(true);
		} else {
			$(this).inputCheck(false);
			$(this).next('i').remove();
		}
	});
	$('.checkinput [data-require="true"]').closest('div').find('label').addClass('require');
}

// Trả về value trước khi nhập
$.fn.inputValue = function (clselement, call) {
	return this.on("input keyup", clselement, function () {
		if (value = call(this)) {
			if (value !== true) {
				this.value = value;
			} else {
				this.oldValue = this.value;
				this.oldSelectionStart = this.selectionStart;
				this.oldSelectionEnd = this.selectionEnd;
			}
		} else if (this.hasOwnProperty("oldValue")) {
			this.value = this.oldValue;
			this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
		} else {
			this.value = "";
		}
	});
};

// Hàm cho phép chọn một hoặc nhiều element
$.fn.selectElement = function () {
	if ($(this).attr('class') != 'empty') {
		if ($(this).attr('data-multi') == 'false') {
			var offsetParent = $(this).offsetParent.className;
			offsetParent = '.' + offsetParent.replace(' ', '.');
			$(offsetParent + ' ' + $(this).prop("tagName")).removeClass('selected');
		}
		if ($(this).attr('class') == 'selected') {
			$(this).removeClass('selected');
		} else {
			$(this).addClass('selected');
		}
	}
}

// Trả về giá trị số trong chuỗi
function getNumeric(string) {
	if (typeof string == 'string') {
		return string.replace(/\D/g, '');
	}
	return false;
}

// Trả về giá trị chuỗi
function getString(string) {
	if (typeof string == 'string') {
		return string.replace(/[^A-z]+/g, '');
	}
	return false;
}

// FORMAT DATE
function formatDate(second) {
	if (second = parseInt(second)) {
		date = new Date(parseInt(second) * 1000);
		return date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
	}
}

// Hàm trả về một chuỗi ký tự ngẫu nhiên
function strRandom(length) {
	var result = '';
	var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	var charactersLength = characters.length;
	for (var i = 0; i < length; i++) {
		result += characters.charAt(Math.floor(Math.random() * charactersLength));
	}
	return result;
}

// Hàm sao chép đoạn văn bản
function strCopy(string) {
	var element = document.createElement('textarea');
	document.body.appendChild(element);
	element.value = string;
	element.focus();
	element.select();
	document.execCommand('Copy');
	element.remove();
}

// Hàm xóa dấu chấm
function removeDot(str) {
	return (str ? str.replace(/[\D\s\._\-]+/g, '') : '');
}

// Hàm trả về chuỗi in hoa chữ cái đầu tiên
function capitalizeFirstLetter(string) {
	return string.charAt(0).toUpperCase() + string.slice(1);
}

// Hàm trả về giá trị cookie
function getCookie(name) {
	var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
	if (match) return match[2];
}

// Thiết lập đường dẫn url xử lý ajax
function setUrl(control, action, prefix = '') {
	url = $('base').attr('href');
	if (url) {
		return url + '/api/v1/' + capitalizeFirstLetter(control) + '/' + action + prefix;
	}
	return '';
}

// Hàm thay đổi url mà không load lại trang
function changeUrl(url) {
	history.pushState({}, null, url);
}

// Hàm xử lý ajax post
function ajaxPost(url, data = {}, call = null, loading = true) {
	var settings = {
		'url': url,
		'method': 'POST',
		'timeout': 0,
		'headers': {},
		'processData': false,
		'mimeType': 'json',
		'cache': false,
		'contentType': false,
		'async': false,
		'data': data,
		'beforeSend': function (event) {
			if (loading) {
				popupLoading(loading);
				event.done(function () {
					popupLoading(false);
				});
			}
		}
	};
	$.ajax(settings).done(function (responsive) {
		if (typeof (call) == 'function') {
			call(responsive);
			inputRequire();
			autofocus();
		}
	});
}

// Auto focus
function autofocus() {
	$('body').find('[data-autofocus="true"]:visible').focus();
}

// Hàm reset form
function resetForm(selector) {
	if (selector) {
		$(selector).trigger("reset");
		$(selector).find('i.fa, i.fas').remove();
		autofocus();
	}
}

// Hàm hiển thị popup hoặc ẩn popup
function getPopup(name) {
	ajaxPost(setUrl('modal', 'get'), formData({ 'name': name }), function (responsive) {
		if (responsive.code == 200) {
			$('#popup .relative').append(responsive.template);
			viewPopup(name, true);
		}
	}, false);
	return '#popup .absolute.' + name;
}

// Hàm hiển thị hoặc ẩn popup
function viewPopup(name, display, all = true) {
	if (display == true) {
		cls = ((name == 'loading' && all === true) ? 'fixed' : 'fixed bgcolor');
		$('#popup').attr('class', cls).show().find('.absolute.' + name).show();
		$('#popup .absolute.auto.' + name).append('<button class="btnclose"><i class="fas fa-times"></i></button>');
		resetForm($('#popup .absolute.' + name + ' form'));
	} else {
		if (all == false) {
			$('#popup .absolute.' + name).hide();
			$('#popup .absolute.auto.' + name).remove();
		} else {
			$('#popup').hide().find('.absolute').hide();
			$('#popup .absolute.auto').remove();
		}
	}
	return '#popup .absolute.' + name;
}

// Popup loading
function popupLoading(display) {
	closeAll = ($('#popup .absolute:visible').length > (display ? 0 : 1)) ? false : true;
	viewPopup('loading', display, closeAll);
}

// Popup Alert
function popupAlert(display, content = '') {
	if (display == true) {
		element = '#popup .absolute.alert';
		$(element).find('.content p').html(content);
		$(document.activeElement).addClass('alert_auto_focus');
		$(element).find('.control .popupClose').focus();
	} else {
		viewPopup('confirm', display, false);
		$('.alert_auto_focus').removeClass('alert_auto_focus').focus();
	}
	viewPopup('alert', display, ($('#popup').find('.absolute:visible').length > 1 ? false : true));
}

// Popup Confirm	
function popupConfirm(display, content = '', call = null) {
	var element = viewPopup('confirm', display, ($('#popup').find('.absolute:visible').length > 1 ? false : true));
	$(element).find('.content p').html(content);
	$(element).find('.control .continue').focus();
	if (typeof (call) == 'function') {
		newClass = strRandom(5);
		$(element).find('.control').addClass('control ' + newClass);
		$(element).on('click', '.control.' + newClass + ' .continue', function () {
			$(element).find('.control').removeClass(newClass);
			return call();
		});
	}
}

// Hiển thị icon header vd:viewIconsHeader('left, search')
function viewIconsHeader(icon) {
	if (icon) {
		$('#header .icons button').addClass('hidden');
		$.each(icon.split(','), function () {
			$('#header .icons button.bars-' + this.trim()).removeClass('hidden');
		});
		$('#header .search').hide();
	}
}

// Hàm hiển thị hoặc đóng menu left
function viewMenuLeft(display) {
	if (display == !0) {
		$('#main .menu-left').addClass('show').find('.content').scrollTop(0).animate({ left: '0' }, 100)
	}
	if (display == !1) {
		$('#main .menu-left').find('.content').animate({ left: '-220px' }, 100);
		setTimeout(function () {
			$('#main .menu-left').removeClass('show');
		}, 100);
	}
}

// Hàm hiển thị hoặc đóng menu left
function viewMenuRight(display) {
	if (display == !0) {
		if ($('#main .menu-right .category ul').length > 0) {
			$('#main .menu-right').addClass('show').find('.content').scrollTop(0).animate({ right: '0' }, 100);
		}
	}
	if (display == !1) {
		$('#main .menu-right').find('.content').animate({ right: '-200px' }, 100);
		setTimeout(function () {
			$('#main .menu-right').removeClass('show');
		}, 100);
	}
}

// Active menuleft
function activeMenuLeft(clsname = null) {
	if (clsname == null) {
		clsname = $('#main .menu').attr('data-active');
	}
	if (clsname) {
		var selector = '#main .menu-left .category > ul > li ';
		$(selector + 'ul').slideUp();
		$(selector + 'a').removeClass('active');
		$(selector).find('.fa-chevron-down').removeClass('fa-chevron-down').addClass('fa-chevron-up');
		$(selector + 'a.' + clsname).addClass('active').find('.fa-chevron-up').removeClass('fa-chevron-up').addClass('fa-chevron-down');
		$(selector + 'a.' + clsname).next().slideToggle();
	}
	return false;
}

// Hàm trả về chuỗi selector danh sách
function themeListSelector() {
	return '#main .theme.theme-list ul';
}

// Hàm xóa một hàng dữ liệu rỗng
function removeRowEmpty() {
	$(themeListSelector() + ' li.empty').remove();
}

// Cập nhật một danh sách mới
function htmlRows(rows) {
	$(themeListSelector()).html(rows);
}

// Thêm mới một hoặc nhiều dòng vào đầu danh sách
function beforeRows(rows) {
	$(themeListSelector()).find('li:first').before(rows);
	removeRowEmpty();
}

// Thêm mới một hoặc nhiều dòng vào cuối danh sách
function appendRows(rows) {
	$(themeListSelector()).append(rows);
	removeRowEmpty();
}

// Cập nhật một dòng dữ liệu trong danh sách
function updateRows(id, row) {
	element = $(themeListSelector() + ' li a[data-id="' + id + '"]').closest('li');
	if (element.length > 0) {
		element.before(row).remove();
	}
}

// Xóa một hoặc nhiều dòng trong danh sách
function deleteRows(id) {
	if (typeof (id) == 'object') {
		$.each(id, function () {
			$(themeListSelector() + ' li a[data-id="' + this + '"]').closest('li').remove();
		});
	} else {
		$(themeListSelector() + ' li a[data-id="' + id + '"]').closest('li').remove();
	}
}

// Hiển thị hoặc ẩn danh sách
function viewList(display) {
	element = '#main .theme.theme-list';
	$(element + '+div').remove();
	if (display == true) {
		$(element).removeClass('hidden');
	} else {
		$(element).addClass('hidden');
	}
	return $(element).closest('.container');
}

// Hàm trả về giá trị input trong form
// options: tag form hoặc {name: value,...}
// params: {name: value,...}
function formData(options = null, params = null) {
	data = false;
	if ($(options).prop("tagName") == 'FORM') {
		var data = new FormData($(options)[0]);
		var notTypes = ['reset', 'submit', 'button', 'hidden'];
		$(options).find('input, textarea, select').each(function () {
			type = $(this).attr('type');
			if ($.inArray(type, notTypes) == -1) {
				value = $(this).val();
				check = $(this).attr('data-check');
				if (!value && check && check == 'false') {
					if ($(this).attr('data-require') == 'true') {
						data = false;
						return false;
					}
				} else {
					if (type == 'checkbox' || type == 'radio') {
						if (this.checked == true) {
							data.append($(this).attr('name'), value);
						}
					} else {
						data.append($(this).attr('name'), value);
					}
				}
			}
		});
		if (data && params) {
			$.each(params, function (name, value) {
				data.append(name, value);
			});
		}
	} else {
		if (typeof (options)) {
			var data = new FormData();
			$.each(options, function (name, value) {
				if ((typeof (value) === 'object' && value !== null) || Array.isArray(value)) {
					data.append(name, JSON.stringify(value));
				} else {
					data.append(name, value);
				}
			});
		}
	}
	return data;
}

// Hàm trả về true nếu là page hiện tại false ngược lại
function currentPage(name) {
	if ($('#main .menu').attr('data-active') == name) {
		return true;
	}
	return false;
}

// Hàm trả về id
function getId() {
	return $('#jsdetailid').attr('data-id');
}

// Hàm trả về cid
function getCid() {
	return $('#jsdetailid').attr('data-cid');
}

function optionSelected() {
	$('body select[data-selected]').each(function () {
		$(this).find('option[value="' + $(this).attr('data-selected') + '"]').attr('selected', 'selected');
	});
}
optionSelected();

// Nội dung thông thông báo
var message = {
	'require': 'Vui lòng nhập đầy đủ thông tin *',
	'confirm': 'Bạn có chắc chắn không?',
	'reset': 'Bạn có muốn RESET FORM nhập liệu không?',
	'permission': 'Bạn vui lòng chọn quyền cần thiết lập!',
	'Invalid': 'Dữ liệu không hợp lệ!'
};

// ==============================================

$(window).resize(function () {
	image = $('#popup .loading img');
	button = $('#popup .alert .popupClose');
	if ($(document).width() > $(document).height()) {
		image.hide();
		button.hide();
		popupLoading(true);
		popupAlert(true, 'Xin lỗi! ứng dụng chỉ sử dụng được trên màn hình dọc.');
	} else {
		popupLoading(false);
		popupAlert(false);
		image.show();
		button.show();
	}
});

// Hiển thị popup theo thuộc tính
$('body').on('click', '[data-popup]', function () {
	if (name = $(this).attr('data-popup')) {
		getPopup(name);
	}
	return false;
});

// Đóng popup
$('#popup').on('click', '.popupClose,button.btnclose', function () {
	if (!$('#popup .absolute.loading').is(':visible')) {
		if ($('#popup .absolute.alert').is(':visible')) {
			popupAlert(false);
		} else if ($('#popup .absolute.confirm').is(':visible')) {
			popupConfirm(false);
		} else {
			popupLoading(false);
		}
	}
});

// Thiết lập input data-check = false
inputRequire();
// Kiểm tra dữ liệu không được rỗng
$('body').on('keyup', '[data-require="true"]', function () {
	var strVal = $(this).val();
	$(this).inputCheck((strVal) ? true : false);
});

// Kiểm tra dữ liệu không được rỗng
$('body').on('keyup', '.checkEmpty', function () {
	var strVal = $(this).val();
	$(this).inputCheck((strVal) ? true : false);
});

// Kiểm tra email hợp lệ
$('body').on('keyup', '.checkEmail', function () {
	check = false;
	if (strVal = $(this).val()) { // Hàm kiểm tra email hợp lệ	
		if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(strVal)) {
			check = true;
		}
	}
	$(this).inputCheck(check);
});

// Kiểm tra username hợp lệ
$('body').on('keyup', '.checkUsername', function () {
	check = false;
	if (/^[A-z0-9]{5,32}$/.test($(this).val())) {
		check = true;
	}
	$(this).inputCheck(check);
});

// Kiểm tra phone hợp lệ
$("body").inputValue('input.checkPhone', function (event) {
	flag = false;
	value = $(event).val();
	if (/^\d*$/.test(value)) {
		if (/^0\d{9}$/.test(value)) {
			flag = true;
		}
		$(event).inputCheck(flag);
		return true;
	}
	$(event).inputCheck(flag);
	return false;
});

// Kiểm tra mật khẩu hợp lệ
$("body").on('keyup', 'input.checkPassword', function () {
	flag = false;
	if (value = $(this).val()) {
		flag = /^\S{6,}$/.test(value)
	}
	$(this).inputCheck(flag);
});

// Kiểm tra mật khẩu hợp lệ
$("body").on('keyup', 'input.confirmPassword', function () {
	flag = false;
	password = $(this).closest('form').find('input.checkPassword').val();
	if ($(this).val() == password) {
		flag = true;
	}
	$(this).inputCheck(flag);
});
// Cho phép nhập dữ liệu phải là số	
$("body").inputValue('input.checkNumeric', function (event) {
	return /^((\d*)\.?(\d*))+$/.test(event.value);
});

// Cho phép nhập dữ liệu phải là số	và định dạng số tiền
$("body").inputValue('input.formatNumeric', function (event) {
	if (num = getNumeric(event.value)) {
		return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.");
	}
	return false;
});
// Hiển thị lịch
$(document).on("focus", ".datepick", function () {
	$(".datepick").datepicker({
		'showAnim': 'slideDown',
		'dateFormat': 'dd/mm/yy'
	});
});
$(document).on("change", ".datepick", function () {
	var inputVal = $(this).val();
	if (inputVal) {
		tmp = inputVal.split('/');
		inputVal = tmp[1] + '/' + tmp[0] + '/' + tmp[2];
		if ($(this).attr('name') == 'timeto') {
			inputVal += ' 23:59:59';
		}
		$(this).attr('data-millisecond', Math.floor((new Date(inputVal).getTime()) / 1000));
	} else {
		$(this).attr('data-millisecond', '');
	}
	return !1
});

// Reset form
$('body').on('click', 'input[type="reset"]', function () {
	form = $(this).closest('form');
	popupConfirm(true, message.reset, function () {
		resetForm(form);
		popupConfirm(false);
	});
	return false;
});

// ==============================================	
// Hiển thị icon mặc định
viewIconsHeader($('#main .theme:visible').attr('data-baricon'));
// Icon back
$('#header .icons').on('click', 'button.bars-back', function () {
	viewList(true);
	viewIconsHeader('left,search');
	ajaxPost(setUrl('user', 'deleteDetail'));
});
// Hiển thị menu left
$('#header .icons').on('click', 'button.bars-left', function () {
	viewMenuLeft(true);
});
// Đóng menu left
$('#main .menu-left').on('click', '.popupClose', function () {
	viewMenuLeft(false);
});
activeMenuLeft();
$('#main .menu-left .category > ul > li > a').click(function () {
	if ($(this).next().length > 0) {
		if ($(this).attr('class').indexOf('active') == -1) {
			activeMenuLeft($(this).attr('class'));
		}
		return false;
	}
});
// Hiển thị menu right
$('#header .icons').on('click', 'button.bars-right', function () {
	viewMenuRight(true);
});
// Đóng menu right
$('#main .menu-right').on('click', '.popupClose', function () {
	viewMenuRight(false);
});
// Hiển thị input tìm kiếm
$('#header .icons').on('click', 'button.bars-search', function () {
	viewIconsHeader('back');
	$('#header .search').show().find('input').val('').focus();
});
$.each(['Bill'], function () {
	$('#header .search.cls' + this).find('button[name="setting"]').removeClass('hidden');
});
// Hiển thị danh sách
if ($('#main .theme.theme-list + div').length == 0) {
	$('#main .theme.theme-list').removeClass('hidden');
	viewIconsHeader($('#main .theme:visible').attr('data-baricon'));
}
// Lựa chọn params search
function convertDate(millisecond) {
	if (millisecond) {
		date = new Date(millisecond * 1000);
		return date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
	}
	return;
}
$('#searchvalue').find('input[name="column"][value="' + $('#searchvalue').attr('data-column') + '"]').prop('checked', true);
if (status = $('#searchvalue').attr('data-status')) {
	$('#searchvalue').find('input[name="status"]').each(function () {
		if (status.indexOf($(this).val()) > -1) {
			$(this).prop('checked', true);
		} else {
			$(this).prop('checked', false);
		}
	});
}
timefrom = $('#searchvalue').attr('data-timefrom');
timeto = $('#searchvalue').attr('data-timeto');
$('#searchvalue').find('input[name="timefrom"]').val(convertDate(timefrom)).attr('data-millisecond', timefrom);
$('#searchvalue').find('input[name="timeto"]').val(convertDate(timeto)).attr('data-millisecond', timeto);
// CHOOSE ADDRESS
$('#main').on('click', '.listaddress li', function () {
	parent = $(this).closest('.form-address');
	node = this.attributes[0];
	if (node) {
		$(parent).find('input').attr(node.nodeName, node.nodeValue).val($(this).text()).focus();
	}
	$(parent).find('.listaddress').remove();
});
// ADDRESS PROVINCE
$('#main').on('keyup', '.form-address input[name="province"]', function () {
	keyword = $(this).val();
	if (keyword.length > 1) {
		$(this).closest('form').find('[data-autofocus="true"]').attr('data-autofocus', 'false');
		parent = $(this).closest('.form-address');
		ajaxPost(
			setUrl('address', 'provinces'),
			formData({ 'keyword': keyword }),
			function (responsive) {
				$(parent).find('.listaddress').remove();
				if (responsive.code == 200) {
					$(parent).append(responsive.rows);
				}
			},
			false
		)
	}
});
// ADDRESS DISTRICT
$('#main').on('keyup', '.form-address input[name="district"]', function () {
	keyword = $(this).val();
	if (keyword.length > 1) {
		$(this).closest('form').find('[data-autofocus="true"]').attr('data-autofocus', 'false');
		parent = $(this).closest('.form-address');
		ajaxPost(
			setUrl('address', 'districts'),
			formData({ 'provinceid': $('input[name="province"]').attr('data-province'), 'keyword': keyword }),
			function (responsive) {
				$(parent).find('.listaddress').remove();
				if (responsive.code == 200) {
					$(parent).append(responsive.rows);
				}
			},
			false
		)
	}
});
// ADDRESS WARDS
$('#main').on('keyup', '.form-address input[name="ward"]', function () {
	keyword = $(this).val();
	if (keyword.length > 1) {
		$(this).closest('form').find('[data-autofocus="true"]').attr('data-autofocus', 'false');
		parent = $(this).closest('.form-address');
		ajaxPost(
			setUrl('address', 'wards'),
			formData({ 'districtid': $('input[name="district"]').attr('data-district'), 'keyword': keyword }),
			function (responsive) {
				$(parent).find('.listaddress').remove();
				if (responsive.code == 200) {
					$(parent).append(responsive.rows);
				}
			},
			false
		)
	}
});
// SCROLL LIST
$('#main>.scrollbarY').scroll(function () {
	element = $(this).find('.theme-list:visible');
	if (element.length > 0) {
		scroll = element.find('ul').attr('data-scroll');
		if (scroll == 'true') {
			client = $(this)[0];
			if (Math.round(client.clientHeight + client.scrollTop) == client.scrollHeight) {
				action = element.find('ul').attr('data-action');
				control = element.attr('class').replace(/theme-list|theme/gi, '').trim();
				if (control) {
					data = formData({
						'action': action,
						'begin': element.find('li').length
					});
					ajaxPost(setUrl(control, 'scroll'), data, function (responsive) {
						if (responsive.code == 200) {
							element.find('ul').attr('data-scroll', responsive.scroll).append(responsive.rows);
						}
					});
				}
			}
		}
	}
});
// CẬP NHẬT MENU RIGHT
function updateMenuRight() {
	menu = $('#main .menu');
	// Menu right bill
	if (menu.attr('data-active') == 'clsBill') {
		detail = $('#main .theme-detail');
		// Ghi chú
		if (detail.find('.notification').length > 0) {
			e = menu.find('a.bill-note').attr('class', 'bill-note-cancel').text('Hủy ghi chú');
		} else {
			e = menu.find('a.bill-note-cancel').attr('class', 'bill-note').text('Ghi chú');
		}
	}
}
updateMenuRight();
// VIEW POPUP SEARCH
$('#header .search').on('click', 'button[name="setting"]', function () {
	if (element = getPopup('search', true)) {
		if ($(element).length > 0) {
			element = $(element).find('.content');
			element.find('input[name="column"][value="' + element.attr('data-column') + '"]').prop('checked', true);
			if (status = element.attr('data-status')) {
				$.each(status.split(','), function () {
					element.find('input[name="status"][value="' + this + '"]').prop('checked', true);
				});
			}
			timefrom = element.attr('data-timefrom');
			element.find('input[name="timefrom"]').attr({ 'data-millisecond': timefrom, 'value': formatDate(timefrom) });
			timeto = element.attr('data-timeto');
			element.find('input[name="timeto"]').attr({ 'data-millisecond': timeto, 'value': formatDate(timeto) });
		}
	}
});
// SET PARAMS SEARCH
$('#popup').on('submit', '.search form', function () {
	element = $(this).closest('.search');
	column = $(element).find('input[name="column"]:checked').val();
	var status = [];
	$(element).find('input[name="status"]:checked').each(function (key, elm) {
		status[key] = $(elm).val();
	});
	var timefrom = $(element).find('input[name="timefrom"]').attr('data-millisecond');
	var timeto = $(element).find('input[name="timeto"]').attr('data-millisecond');
	if (column && status) {
		data = formData({ 'column': column, 'status': status, 'timefrom': timefrom, 'timeto': timeto });
		ajaxPost(setUrl('setting', 'searchParams'), data, function (responsive) {
			if (responsive.code == 200) {
				viewPopup('search', false);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	} else {
		popupAlert(true, message.require);
	}
	return false;
});
// ====================USER CONTROL==========================

// LOGIN====================	
// Thực hiện đăng nhập
$('#main .login').on('submit', 'form', function(){	
	email = $(this).find('input[name="email"]').attr('data-check');
	password = $(this).find('input[name="password"]').attr('data-check');
	if(email && password && (email == 'true') && (password == 'true')){
		return true;
	}
	return false;
});
// ADD====================
$('#main .menu .clsUser + ul').on('click', 'a.add', function(){	
	data = {onpage : currentPage('clsUser')};
	ajaxPost(setUrl('user', 'add'),formData(data),function(responsive){
		if(data.onpage == true){
			viewMenuLeft(false);
			if(responsive.code == 200){						
				viewIconsHeader('back');
				viewList(false).append(responsive.form);		
			}else{
				popupAlert(true, responsive.message);
			}
		}
	});
	return (data.onpage?false:true);
});
$('#main').on('submit', '.theme.user .form.add', function(){		
	data = formData(this);
	if(data){
		popupConfirm(true, message.confirm, function(){
			ajaxPost(setUrl('user', 'add'),data,function(responsive){
				popupAlert(true, responsive.message);
				if(responsive.code == 200){
					beforeRows(responsive.rows);
					viewList(false).append(responsive.permission);
				}
			});
		});
	}else{
		popupAlert(true, message.require);
	}
	return false;
});
// DETAIL====================
$('#main .theme-list.user').on('click', 'ul li a', function(){
	if((id = $(this).attr('data-id')) && $.isNumeric(id)){			
		ajaxPost(setUrl('user', 'detail'),formData({id: id}),function(responsive){
			if(responsive.code == 200){
				viewIconsHeader('back, right');
				viewList(false).append(responsive.detail);			
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// DELETE
$('#main .menu-right').on('click', '.user-delete', function(){
	viewMenuRight(false);		
	popupConfirm(true, message.confirm, function(){
		ajaxPost(setUrl('user', 'delete'),{}, function(responsive){
			popupConfirm(false);
			if(responsive.code == 200){				
				deleteRows(responsive.id);
				$('#header .icons button.bars-back').click();
			}else{
				popupAlert(true, responsive.message);
			}
		});
	});
});	
// PERMISSION VIEW
$('#main .menu-right').on('click', '.user-permission', function(){		
	ajaxPost(setUrl('user', 'permission'), formData({'get': 'true'}),function(responsive){
		viewMenuRight(false);	
		if(responsive.code == 200){
			viewIconsHeader('back');
			viewList(false).append(responsive.permission);		
		}else{
			popupAlert(true, responsive.message);
		}			
	});
	return false;
});
// PERMISSION SET
$('#main').on('click', '.submit-permission', function(){	
	var permission = [];
	$(this).closest('.theme.user').find('.permission input[type="checkbox"]:checked').each(function(index, value){
		permission[index] = $(value).val();
	});
	if(permission){		
		popupConfirm(true, message.confirm, function(){
			ajaxPost(
				setUrl('user', 'permission'),
				formData({
					'set': 'true', 
					'permission': permission
				}),
				function(responsive){						
					viewMenuRight(false);	
					popupAlert(true, responsive.message);			
				}
			);
		});
	}else{
		popupAlert(true, message.permission);
	}
	return false;
});
// CHOOSE PERMISSION
$('#main').on('click', '.label.parent-permission', function(){
	checked = ($(this).find('input:checked').length>0)?true:false;
	element = $(this).closest('li').find('div');		
	if(element.length>0){
		$(element).find('input[type="checkbox"]').each(function(){				
			$(this).prop('checked', checked);
		});
	}
});
// VIEW FORM CHANGE PASSWORD
$('#main .menu').on('click', 'a.changepassword', function(){
	viewMenuLeft(false);
	getPopup('password', true);
	return false;
});
// CHANGE PASSWORD
$('#popup').on('submit', '.absolute.password form', function(){		
	if(data = formData(this)){			
		popupConfirm(true, message.confirm, function(){
			ajaxPost(setUrl('user', 'changePassword'), data, function(responsive){
				popupAlert(true, responsive.message);
				if(responsive.code == 200){
					viewPopup('password', false, false);
				}
			});
		});
	}else{
		if($(this).find('input[name="password"]').val()){
			popupAlert(true, message.Invalid);
		}else{
			popupAlert(true, message.require);
		}
	}
	return false;
});
// SEARCH
$('#header .search.clsUser').on('submit', 'form', function(){
	if(data = formData(this)){
		ajaxPost(setUrl('user', 'search'), data, function(responsive){
			if(responsive.code == 200){			
				htmlRows(responsive.rows);
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});// ====================SETTING CONTROL==========================
// SET INFORMATION
$('#main').on('click', '.theme.setting .setinfo', function(){		
	var data = formData($(this).closest('form'));	
	data.append('note1', CKEDITOR.instances.note1.getData());
	data.append('note2', CKEDITOR.instances.note2.getData());
	popupConfirm(true, message.confirm, function(){
		ajaxPost(setUrl('setting', 'info'),data,function(responsive){
			popupAlert(true, responsive.message);
		});
	});
	return false;
});
// SET PRINT
$('#main').on('click', '.theme.setting .setprint', function(){
	var data = formData($(this).closest('form'));
	popupConfirm(true, 'Bạn có chắc chắn không?', function(){
		ajaxPost(setUrl('setting', 'print'),data,function(responsive){
			popupAlert(true, responsive.message);
		});
	});
	return false;
});
// SET POST
$('#main').on('click', '.theme.setting .setpost', function(){
	var data = formData($(this).closest('form'));
	popupConfirm(true, message.confirm, function(){
		ajaxPost(setUrl('setting', 'post'),data,function(responsive){
			popupAlert(true, responsive.message);
		});
	});
	return false;
});
// SEARCH
$('#header .search.clsSetting').on('submit', 'form', function(){	
	return false;
});// ====================INVENTORY CONTROL==========================	
// ADD====================
$('#main .menu .clsInventory + ul').on('click', 'a.add', function () {
	data = { onpage: currentPage('clsInventory') };
	ajaxPost(
		setUrl('inventory', 'add'),
		formData(data),
		function (responsive) {
			if (data.onpage == true) {
				viewMenuLeft(false);
				if (responsive.code == 200) {
					viewIconsHeader('back');
					viewList(false).append(responsive.form);
				} else {
					popupAlert(true, responsive.message);
				}
			}
		}
	);
	return (data.onpage ? false : true);
});
$('#main').on('submit', '.theme.inventory .form.add', function () {
	data = formData(this);
	if (data) {
		popupConfirm(true, message.confirm, function () {
			ajaxPost(
				setUrl('inventory', 'add'), data,
				function (responsive) {
					popupConfirm(false);
					if (responsive.code == 200) {
						viewIconsHeader('back, right');
						beforeRows(responsive.rows);
						viewList(false).append(responsive.detail);
					} else {
						popupAlert(true, responsive.message);
					}
				}
			);
		});
	} else {
		popupAlert(true, message.require);
	}
	return false;
});
// VIEW DETAIL
$('#main').on('click', '.theme-list.inventory li a', function () {
	id = $(this).attr('data-id');
	if (id && $.isNumeric(id)) {
		ajaxPost(setUrl('inventory', 'detail'), formData({ 'id': id }), function (responsive) {
			if (responsive.code == 200) {
				viewIconsHeader('back, right');
				viewList(false).append(responsive.detail);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// VIEW FORM EDIT
$('#main .menu-right').on('click', 'a.inventory-edit', function () {
	if (id = getId()) {
		viewMenuRight(false);
		popupConfirm(true, message.confirm, function () {
			ajaxPost(setUrl('inventory', 'edit'), formData({ 'id': id, 'onpage': true }), function (responsive) {
				popupConfirm(false);
				if (responsive.code == 200) {
					viewIconsHeader('back');
					viewList(false).append(responsive.edit);
				} else {
					popupAlert(true, responsive.message);
				}
			});
		});
	}
	return false;
});
// SET FORM EDIT
$('#main').on('submit', '.theme-form.inventory .form.edit', function () {
	if (data = formData(this)) {
		popupConfirm(true, message.confirm, function () {
			ajaxPost(setUrl('inventory', 'edit'), data, function (responsive) {
				popupConfirm(false);
				if (responsive.code == 200) {
					viewIconsHeader('back, right');
					updateRows(responsive.id, responsive.rows);
					viewList(false).append(responsive.detail);
				} else {
					popupAlert(true, responsive.message);
				}
			});
		});
	}
	return false;
});
// SEARCH
$('#header .search.clsInventory').on('submit', 'form', function () {
	if (data = formData(this)) {
		ajaxPost(setUrl('inventory', 'search'), data, function (responsive) {
			if (responsive.code == 200) {
				htmlRows(responsive.rows);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// ====================IMPORT CONTROL==========================	
// VIEW FORM
$('#main').on('click', '.theme-list.import li a', function(){
	id = $(this).attr('data-id');
	if(id && $.isNumeric(id)){
		ajaxPost(setUrl('import', 'detail'),formData({'id': id}), function(responsive){
			if(responsive.code == 200){
				viewIconsHeader('back');
				viewList(false).append(responsive.theme);
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// CONFIRM
$('#main').on('submit', '.theme.import .form.confirmimport', function(){		
	if(data = formData(this)){
		data.set('amount', getNumeric(data.get('amount')));;
		popupConfirm(true, message.confirm, function(){
			ajaxPost(
				setUrl('import', 'confirm'),data,
				function(responsive){	
					popupConfirm(false);
					if(responsive.code == 200){						
						viewIconsHeader('back');
						updateRows(responsive.id, responsive.rows);
						viewList(false).append(responsive.detail);
					}else{
						popupAlert(true, responsive.message);
					}
				}
			);
		});
	}else{
		popupAlert(true, message.require);
	}		
	return false;
});// ====================BILL CONTROL==========================
// VIEW FORM ADD
$('#main .menu .clsBill + ul').on('click', 'a.add', function(){		
	data = {onpage : currentPage('clsBill')};		
	ajaxPost(setUrl('bill', 'add'),formData(data),function(responsive){
		if(data.onpage == true){
			viewMenuLeft(false);
			if(responsive.code == 200){						
				viewIconsHeader('back');
				viewList(false).append(responsive.form);		
			}else{
				popupAlert(true, responsive.message);
			}
		}
	});
	return (data.onpage?false:true);
});
// SET FORM ADD
$('#main').on('submit', '.theme-form.bill form.add', function(){
	data = formData(this);
	if(data){
		data.append('provinceid', $(this).find('[data-province]').attr('data-province'));
		data.append('districtid', $(this).find('[data-district]').attr('data-district'));
		data.append('wardid', $(this).find('[data-ward]').attr('data-ward'));
		if(data){
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'add'),data, function(responsive){
					popupConfirm(false);
					if(responsive.code == 200){						
						viewIconsHeader('back, right');
						beforeRows(responsive.rows);
						viewList(false).append(responsive.detail);
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});
		}
	}else{
		popupAlert(true, message.require);
	}		
	return false;
});
// VIEW POPUP FB UID
$('#main').on('click', '.get-uid', function(){
	getPopup('uid', true);
	return false;
});
// GET FB UID
$('#popup').on('click', '.absolute.uid input[name="get-uid"]', function(){		
	parent = $(this).closest('form');
	data = formData(parent);		
	if(data){			
		ajaxPost(setUrl('facebook', 'getUid'),data, function(responsive){
			if(responsive.code == 200){
				$(parent).find('.result').html('<p class="success">'+responsive.uid+'</p>');
				$(parent).find('input[name="get-uid"]').attr({'name': 'use-uid', 'value': 'Sử dụng UID'});
			}else{
				$(parent).find('.result').html('<p class="error">'+responsive.message+'</p>');
			}				
		});
	}		
	return false;
});
// USE FB UID
$('#popup').on('click', '.absolute.uid input[name="use-uid"]', function(){
	uid = $(this).closest('form').find('.result p').text();
	if(uid){
		viewPopup('uid', false);
		$('#popup .absolute.uid .result p').remove();
		$('#popup .absolute.uid input[name="use-uid"]').attr({'name': 'get-uid', 'value': 'Thực hiện'});
		$('#main input[name="profileid"]').val(uid).focus();
	}
	return false;
});
// VIEW BILL DETAIL
$('#main').on('click', '.theme-list.bill li a', function(){
	id = $(this).attr('data-id');
	if(id && $.isNumeric(id)){
		ajaxPost(setUrl('bill', 'detail'),formData({'id': id}), function(responsive){
			if(responsive.code == 200){
				viewIconsHeader('back, right');
				viewList(false).append(responsive.detail);
				updateMenuRight();
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// VIEW BILL EDIT
$('#main .menu-right').on('click', 'a.bill-edit', function(){
	if(id = getId()){
		viewMenuRight(false);
		popupConfirm(true, message.confirm, function(){
			ajaxPost(setUrl('bill', 'edit'), formData({'id':id, 'onpage': true}), function(responsive){
				popupConfirm(false);
				if(responsive.code == 200){					
					viewIconsHeader('back');						
					viewList(false).append(responsive.edit);
				}else{
					popupAlert(true, responsive.message);
				}
			});
		});
	}	
});
// SET FORM EDIT
$('#main').on('submit', '.theme-form.bill form.edit', function(){
	data = formData(this);
	if(data){
		data.append('provinceid', $(this).find('[data-province]').attr('data-province'));
		data.append('districtid', $(this).find('[data-district]').attr('data-district'));
		data.append('wardid', $(this).find('[data-ward]').attr('data-ward'));
		if(data){
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'edit'),data, function(responsive){
					popupConfirm(false);
					if(responsive.code == 200){					
						viewIconsHeader('back, right');
						element = $(themeListSelector()+' a[data-cid="'+responsive.cid+'"]');
						element.find('h3').text(responsive.name);
						element.find('img').attr('src', responsive.image);
						element.find('.phone strong').text(responsive.phone);
						element.find('.address span').text(responsive.address);
						if(responsive.phone && responsive.address){
							element.find('span.warning').remove();
						}else{
							element.find('.item .row1').append('<span class="warning">Thông tin</span>');
						}
						viewList(false).append(responsive.detail);
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});
		}
	}else{
		popupAlert(true, message.require);
	}		
	return false;
});
// SEARCH
$('#header .search.clsBill').on('submit', 'form', function(){
	data = formData(this);	
	if(data.get('keyword')){		
		ajaxPost(setUrl('bill', 'search'), data, function(responsive){
			if(responsive.code == 200){			
				htmlRows(responsive.rows);
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// LIST CUSTOMER
$('#main .menu-right').on('click', 'a.bill-csid', function(){
	if(cid = getCid()){
		ajaxPost(setUrl('bill', 'list'), formData({'cid':cid}), function(responsive){
			if(responsive.code == 200){
				viewMenuRight(false);
				viewIconsHeader('left, search');
				viewList(true).find('.theme-list ul').attr({
					'data-action': responsive.action,
					'data-scroll': responsive.scroll,
				}).html(responsive.rows);				
				changeUrl(responsive.url);
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}	
});
// NOTE
$('#main .menu-right').on('click', 'a.bill-note', function(){
	viewMenuRight(false);
	element = getPopup('reason', true);	
	$(element).find('form').attr('class', 'sbnote');
	$(element).find('h3').text('Ghi chú');
	$(element).find('textarea').focus();
});
$('#popup').on('submit', '.reason form.sbnote', function(){
	if(cid = getCid()){
		if(data = formData(this)){
			viewPopup('reason', false);
			data.append('cid', cid);
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'note'), data, function(responsive){
					popupConfirm(false);
					if(responsive.code == 200){							
						$('#main .theme-detail.bill .note>*:first-child').before(responsive.note);	
						updateMenuRight();
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});
		}
	}
	return false;
});
// CANCEL NOTE
$('#main .menu-right').on('click', 'a.bill-note-cancel', function(){
	if(cid = getCid()){
		viewMenuRight(false);		
		popupConfirm(true, message.confirm, function(){
			ajaxPost(setUrl('bill', 'note'), formData({'cid':cid, 'content':'cancel'}), function(responsive){
				popupConfirm(false);
				if(responsive.code == 200){
					viewPopup('reason', false);			
					$('#main .theme-detail.bill .note .notification').remove();	
					updateMenuRight();
				}else{
					popupAlert(true, responsive.message);
				}
			});
		});
	}
	
});
// VIEW COMMENT
$('#main .menu-right').on('click', 'a.bill-comment', function(){
	if(cid = getCid()){
		viewMenuRight(false);
		ajaxPost(setUrl('bill', 'comment'), formData({'cid':cid}), function(responsive){			
			if(responsive.code == 200){				
				$(getPopup('comment', true)).find('.content').attr('data-scroll', responsive.scroll).html(responsive.comment);				
			}else{
				popupAlert(true, responsive.message);
			}
		});
	}
});
// SCROLL COMMENT
$('#popup .comment .scrollbarY').scroll(function(){
	if(cid = getCid()){
		if((scroll = $(this).attr('data-scroll')) == 'true'){
			element = $(this);
			if (Math.round(element[0].clientHeight + element[0].scrollTop) == element[0].scrollHeight){
				console.log(element.find('tr').length);
				data = formData({
					'cid'	:cid,
					'begin' : element.find('tr').length
				});
				ajaxPost(setUrl('bill', 'scrollComment'), data, function(responsive){
					if(responsive.code == 200){
						element.attr('data-scroll', responsive.scroll).append(responsive.comment);
					}else{
						popupAlert(true, responsive.message);
					}
				});
			}
		}		
	}
});
// SEND BILL
$('#main .menu-right').on('click', 'a.bill-send', function(){
	if(cid = getCid()){
		viewMenuRight(false);
		popupAlert(true, 'Chưa làm phần này');
	}
});
// CREATED
$('#main .menu-right').on('click', 'a.bill-create', function(){	
	viewMenuRight(false);
	popupConfirm(true, message.confirm, function(){
		ajaxPost(setUrl('bill', 'created'), {}, function(responsive){
			popupConfirm(false);
			if(responsive.code == 200){
				deleteRows(responsive.id);
				beforeRows(responsive.rows);
				$('#main .theme-detail .customer .time .create').text(responsive.created)
			}else{
				popupAlert(true, responsive.message);
			}
		});
	});	
});
// COPY
$('#main .menu-right').on('click', 'a.bill-copy', function(){
	viewMenuRight(false);
	popupConfirm(true, message.confirm, function(){
		ajaxPost(setUrl('bill', 'copy'), {}, function(responsive){
			popupConfirm(false);
			if(responsive.code == 200){				
				beforeRows(responsive.rows);
				viewList(false).append(responsive.detail);
				updateMenuRight();
			}else{
				popupAlert(true, responsive.message);
			}
		});
	});	
});
// SPECIAL
$('#main .menu-right').on('click', 'a.bill-special', function(){
	viewMenuRight(false);
	element = getPopup('special', true);
	$(element).find('form').attr('class', $(this).attr('data-name'));
	$(element).find('h3').text($(this).text());
});
// BILL SALE
$('#popup').on('submit', '.special .sale', function(){
	if(data = formData(this)){
		if(price = data.get('price')){
			data.set('price', price);
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'sale'), data, function(responsive){
					if(responsive.code == 200){
						// code
						updateMenuRight();
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});		
		}
	}else{
		popupAlert(true, message.require);
	}
	return false;
});
// BILL SURCHARGE
$('#popup').on('submit', '.special .surcharge', function(){
	if(data = formData(this)){
		if(price = data.get('price')){
			data.set('price', price);
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'surcharge'), data, function(responsive){
					if(responsive.code == 200){
						// code
						updateMenuRight();
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});		
		}
	}else{
		popupAlert(true, message.require);
	}
	return false;
});
// BILL DEBT
$('#popup').on('submit', '.special .debt', function(){
	if(data = formData(this)){
		if(price = data.get('price')){
			data.set('price', price);
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'debt'), data, function(responsive){
					if(responsive.code == 200){
						// code
						updateMenuRight();
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});		
		}
	}else{
		popupAlert(true, message.require);
	}
	return false;
});
// BILL TRANSFER
$('#popup').on('submit', '.special .transfer', function(){
	if(data = formData(this)){
		if(price = data.get('price')){
			data.set('price', price);
			popupConfirm(true, message.confirm, function(){
				ajaxPost(setUrl('bill', 'transfer'), data, function(responsive){
					if(responsive.code == 200){
						// code
						updateMenuRight();
					}else{
						popupAlert(true, responsive.message);
					}
				});
			});		
		}
	}else{
		popupAlert(true, message.require);
	}
	return false;
});
// VIEW PRODUCT LIST
$('#main').on('click', '.theme-detail.bill .addproduct', function(){
	if(element = getPopup('addproduct')){
		ajaxPost(setUrl('bill', 'product'), formData({'begin':0}), function(responsive){			
			if(responsive.code == 200){				
				$(element).find('.content ul').attr({'data-scroll': responsive.scroll}).html(responsive.rows);
			}else{
				viewPopup('addproduct', false);
				popupAlert(true, responsive.message);
			}
		});
		// Scroll		
		$(element).find('.scrollbarY').scroll(function(){
			current = $(this).find('ul');
			if(current.attr('data-scroll') == 'true'){			
				client = $(this)[0];
				if (Math.round(client.clientHeight + client.scrollTop) == client.scrollHeight){
					data = formData({
						'keyword' : $(current).closest('.addproduct').find('input[name="keyword"]').val(),
						'begin'	  : $(current).find('li').length			
					});
					ajaxPost(setUrl('bill', 'product'), data, function(responsive){			
						if(responsive.code == 200){				
							$(current).attr({'data-scroll': responsive.scroll}).append(responsive.rows);
						}
					});
				}
			}
		});
		// Search
		$(element).on('submit', '.title form', function(){
			current = $(this).closest('.addproduct').find('ul');
			data = formData(this);
			if(data.get('keyword')){
				ajaxPost(setUrl('bill', 'product'), data, function(responsive){			
					if(responsive.code == 200){				
						$(current).attr({'data-scroll': responsive.scroll}).html(responsive.rows);
					}
				});
			}else{
				popupAlert(true, message.require);
			}
			return false;
		});
		// Add product
		$(element).on('click', 'li a', function(){
			input = $(this).find('form.change input[type="text"]');
			if(!$(input).is(':focus')){
				if(id = $(this).attr('data-id')){	
					current = '';
					amount = parseInt(input.val()) + 1;		
					if(amount>1){
						current = 'true';
					}
					data = formData({					
						'action' 	: 'addproduct',
						'current'	: current,
						'productid' : id,
						'amount' 	: amount
					});
					ajaxPost(setUrl('bill', 'product'), data, function(responsive){			
						if(responsive.code == 200){		
							input.val(data.get('amount')).closest('li').addClass('active');
							viewList(false).append(responsive.detail);
						}else{
							popupAlert(true, responsive.message);
						}
					});
				}
			}			
			return false;
		});
		// Add Product
		$(element).on('submit', 'form.change input[type="text"]', function(){
			$(this).closest('a').click();
			return false;
		});
	}
});


// CLOSE ADD PRODUCT
$('#popup').on('click', '.absolute.addproduct .title button.bars-back', function(){
	viewPopup('addproduct', false);
});
$('.jhfklghjl').on('click', function(){
	console.log(this);
	return false;
});
$('.fdfkflg').on('click', function(){
	return false;
});
$('#popup').on('submit', '.absolute.addproduct form.change', function(){
	console.log($(this).find('input').val());
	return false;
});// ====================PRODUCT CONTROL==========================	
// ADD UNIT
$('#popup').on('click', 'button.addunit', function () {
	if (name = $('#input-unitname').val()) {
		ajaxPost(setUrl('product', 'addUnit'), formData({ 'name': name }), function (responsive) {
			if (responsive.code == 200) {
				$('#input-unitname').val('').focus();
				$('#tr-list-unit').html(responsive.rows.tr);
				$('#select-list-units').html(responsive.rows.option);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	} else {
		popupAlert(true, message.require);
	}
	return false;
});
// VIEW UNIT
$('#main').on('click', '.theme-form.product .popupunit', function () {
	if (getPopup('unit')) {
		ajaxPost(setUrl('product', 'unit'), {}, function (responsive) {
			if (responsive.code == 200) {
				$('#popup .absolute.unit .table tbody').html(responsive.rows.tr);
			}
		});
	}
});
// ADD====================
$('#main .menu .clsProduct + ul').on('click', 'a.add', function () {
	data = { onpage: currentPage('clsProduct') };
	ajaxPost(setUrl('product', 'add'), formData(data), function (responsive) {
		if (data.onpage == true) {
			viewMenuLeft(false);
			if (responsive.code == 200) {
				viewIconsHeader('back');
				viewList(false).append(responsive.form);
			} else {
				popupAlert(true, responsive.message);
			}
		}
	});
	return (data.onpage ? false : true);
});
$('#main').on('submit', '.theme.product .form.add', function () {
	data = formData(this);
	if (data) {
		if ((data.get('inventoryid') && data.get('inventoryid') == '0') || (data.get('unitid') && data.get('unitid') == '0')) {
			popupAlert(true, message.require);
		} else {
			data.append('action', $(this).attr('data-action'));
			data.set('price-import', getNumeric(data.get('price-import')));
			data.set('price-seller', getNumeric(data.get('price-seller')));
			data.set('amount', getNumeric(data.get('amount')));
			popupConfirm(true, message.confirm, function () {
				ajaxPost(
					setUrl('product', 'add'), data,
					function (responsive) {
						popupConfirm(false);
						if (responsive.code == 200) {
							viewIconsHeader('back, right');
							beforeRows(responsive.rows);
							viewList(false).append(responsive.detail);
						} else {
							popupAlert(true, responsive.message);
						}
					}
				);
			});
		}
	} else {
		popupAlert(true, message.require);
	}
	return false;
});
// VIEW DETAIL
$('#main').on('click', '.theme-list.product li a', function () {
	id = $(this).attr('data-id');
	if (id && $.isNumeric(id)) {
		ajaxPost(setUrl('product', 'detail'), formData({ 'id': id }), function (responsive) {
			if (responsive.code == 200) {
				viewIconsHeader('back, right');
				viewList(false).append(responsive.detail);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// VIEW FORM EDIT
$('#main .menu-right').on('click', 'a.product-edit', function () {
	if (id = getId()) {
		viewMenuRight(false);
		popupConfirm(true, message.confirm, function () {
			ajaxPost(setUrl('product', 'edit'), formData({ 'id': id, 'onpage': true }), function (responsive) {
				popupConfirm(false);
				if (responsive.code == 200) {
					viewIconsHeader('back');
					viewList(false).append(responsive.edit);
					optionSelected();
				} else {
					popupAlert(true, responsive.message);
				}
			});
		});
	}
	return false;
});
// SET FORM EDIT
$('#main').on('submit', '.theme-form.product .form.edit', function () {
	if (data = formData(this)) {
		data.set('price-import', getNumeric(data.get('price-import')));
		data.set('price-seller', getNumeric(data.get('price-seller')));
		data.set('amount', getNumeric(data.get('amount')));
		popupConfirm(true, message.confirm, function () {
			ajaxPost(setUrl('product', 'edit'), data, function (responsive) {
				popupConfirm(false);
				if (responsive.code == 200) {
					viewIconsHeader('back, right');
					updateRows(responsive.id, responsive.rows);
					viewList(false).append(responsive.detail);
				} else {
					popupAlert(true, responsive.message);
				}
			});
		});
	}
	return false;
});
// DELETE
$('#main .menu-right').on('click', 'a.product-delete', function () {
	viewMenuRight(false);
	popupConfirm(true, message.confirm, function () {
		ajaxPost(setUrl('product', 'delete'), formData({}), function (responsive) {
			popupConfirm(false);
			if (responsive.code == 200) {
				deleteRows(responsive.id);
				viewIconsHeader('left, search');
				viewList(true);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	});
});
// SEARCH
$('#header .search.clsProduct').on('submit', 'form', function () {
	if (data = formData(this)) {
		ajaxPost(setUrl('product', 'search'), data, function (responsive) {
			if (responsive.code == 200) {
				htmlRows(responsive.rows);
			} else {
				popupAlert(true, responsive.message);
			}
		});
	}
	return false;
});
// update image
$('#main').on('change', '#image_upload', function () {
	element = $(this).next('.view-img');
	data = new FormData();
	data.append('image', $(this)[0].files[0]);
	if (element.find('img').length > 0) {
		data.append('image_old', element.find('img').attr('src'));
	} else {
		data.append('image_old', '');
	}
	ajaxPost(setUrl('product', 'updateImage'), data, function (responsive) {
		if (responsive.code == 200) {
			element.html('<img src="' + responsive.image + '" alt=""/>');
		} else {
			popupAlert(true, responsive.message);
		}
	});
});});